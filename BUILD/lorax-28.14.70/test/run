#!/bin/sh -e
# This is the expected entry point for Cockpit CI; will be called without
# arguments but with an appropriate $TEST_OS, and optionally $TEST_SCENARIO

export BACKEND="${BACKEND:-lorax-composer}"

if [ "$BACKEND" == "osbuild-composer" ] || [ "$TEST_SCENARIO" == "osbuild-composer" ]; then
    rm -rf ./test/images/*
    export BACKEND="osbuild-composer"
    make BACKEND=osbuild-composer vm
else
    make vm
fi

if [ "$TEST_SCENARIO" == "ci" ]; then
    test/check-cli TestPylint
else
    test/check-cli TestImages
fi
